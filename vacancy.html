<!DOCTYPE html>
<html lang="en">
<head>
    <title>Vacancies - JobBoard</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Find your dream job with our comprehensive job board" />
    <meta name="keywords" content="jobs, careers, employment, hiring" />
    
    <link rel="stylesheet" href="css/custom-bs.css">
    <link rel="stylesheet" href="css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="css/bootstrap-select.min.css">
    <link rel="stylesheet" href="fonts/icomoon/style.css">
    <link rel="stylesheet" href="fonts/line-icons/style.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body id="top">
    <div class="site-wrap">
        <div class="site-mobile-menu site-navbar-target">
            <div class="site-mobile-menu-header">
                <div class="site-mobile-menu-close mt-3">
                    <span class="icon-close2 js-menu-toggle"></span>
                </div>
            </div>
            <div class="site-mobile-menu-body"></div>
        </div>

        <!-- NAVBAR -->
        <header class="site-navbar mt-3">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="site-logo col-6"><a href="index.html">JobBoard</a></div>

                    <nav class="mx-auto site-navigation">
                        <ul class="site-menu js-clone-nav d-none d-xl-block ml-0 pl-0">
                            <li><a href="index.html">Home</a></li>
                            <li><a href="vacancy.html" class="nav-link active">Vacancy</a></li>
                            <li><a href="calculator.html">Calculator</a></li>
                        </ul>
                    </nav>
                    
                    <div class="right-cta-menu text-right d-flex aligin-items-center col-6">
                        <div class="ml-auto">
                            <a href="#" class="btn btn-outline-white border-width-2 d-none d-lg-inline-block">
                                <span class="mr-2 icon-add"></span>Post a Job
                            </a>
                            <a href="#" class="btn btn-primary border-width-2 d-none d-lg-inline-block">
                                <span class="mr-2 icon-lock_outline"></span>Log In
                            </a>
                        </div>
                        <a href="#" class="site-menu-toggle js-menu-toggle d-inline-block d-xl-none mt-lg-2 ml-3">
                            <span class="icon-menu h3 m-0 p-0 mt-2"></span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Search Section -->
        <section class="section-hero overlay inner-page bg-image" style="background-image: url('images/hero_1.jpg');" id="home-section">
            <div class="container">
                <div class="row">
                    <div class="col-md-7">
                        <h1 class="text-white font-weight-bold">Search Jobs</h1>
                        <div class="custom-breadcrumbs">
                            <a href="index.html">Home</a> <span class="mx-2 slash">/</span>
                            <span class="text-white"><strong>Vacancies</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="site-section">
            <div class="container">
            </div>
        </section>

        <section class="home-section section-hero overlay bg-image" style="background-image: url('images/hero_1.jpg');" id="home-section">
            <div class="container">
                <div class="row align-items-center justify-content-center">
                    <div class="col-md-12">
                        <div class="mb-5 text-center">
                            <h1 class="text-white font-weight-bold">Find Your Perfect Job</h1>
                            <p>Explore top vacancies across various industries</p>
                        </div>
                        
                        <!-- Vacancy Filters -->
                        <div class="row mb-5">
                            <div class="col-md-4 mb-3">
                                <select id="industry-filter" class="form-control form-control-lg">
                                    <option value="">All Industries</option>
                                    <option value="tech">Technology</option>
                                    <option value="finance">Finance</option>
                                    <option value="healthcare">Healthcare</option>
                                    <option value="education">Education</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <select id="location-filter" class="form-control form-control-lg">
                                    <option value="">All Locations</option>
                                    <option value="london">London</option>
                                    <option value="manchester">Manchester</option>
                                    <option value="remote">Remote</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button type="button" onclick="filterVacancies()" class="btn btn-primary btn-lg btn-block text-white">
                                    <span class="icon-filter icon mr-2"></span>Apply Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VACANCIES SECTION -->
        <section class="site-section">
            <div class="container">
                <div class="row mb-5 justify-content-center">
                    <div class="col-md-7 text-center">
                        <h2 class="section-title mb-2">Top Vacancies</h2>
                    </div>
                </div>
                
                <div id="loading-spinner" class="text-center mb-4" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>

                <div id="vacancies-container">
                    <!-- Vacancies will be dynamically loaded here -->
                </div>

                <div class="row mt-5">
                    <div class="col-md-12 text-center">
                        <button id="load-more-btn" class="btn btn-primary btn-lg" onclick="loadMoreVacancies()">
                            Load More Vacancies
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        
        <footer class="site-footer">
            <a href="#top" class="smoothscroll scroll-top">
                <span class="icon-keyboard_arrow_up"></span>
            </a>

            <div class="container">
                <div class="row mb-5">
                    <div class="col-6 col-md-3 mb-4 mb-md-0">
                        <h3>Search Trending</h3>
                        <ul class="list-unstyled">
                            <li><a href="#">Web Design</a></li>
                            <li><a href="#">Graphic Design</a></li>
                        </ul>
                    </div>
                    <div class="col-6 col-md-3 mb-4 mb-md-0">
                        <h3>Company</h3>
                        <ul class="list-unstyled">
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Career</a></li>
                            <li><a href="#">Resources</a></li>
                        </ul>
                    </div>
                    <div class="col-6 col-md-3 mb-4 mb-md-0">
                        <h3>Support</h3>
                        <ul class="list-unstyled">
                            <li><a href="#">Privacy</a></li>
                            <li><a href="#">Terms of Service</a></li>
                        </ul>
                    </div>
                    <div class="col-6 col-md-3 mb-4 mb-md-0">
                        <h3>Contact Us</h3>
                        <div class="footer-social">
                            <a href="#"><span class="icon-facebook"></span></a>
                            <a href="#"><span class="icon-twitter"></span></a>
                            <a href="#"><span class="icon-instagram"></span></a>
                            <a href="#"><span class="icon-linkedin"></span></a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- SCRIPTS -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/stickyfill.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/script.js"></script>

    <script>
        // Vacancy page script for dynamic job loading and filtering
        let currentPage = 1;
        const jobsPerPage = 10;
        let allVacancies = [];
        let filteredVacancies = [];
    
        // Enhanced Error Handling Fetch Function
        async function fetchVacancies(query = 'top') {
            const loadingSpinner = document.getElementById('loading-spinner');
            const vacanciesContainer = document.getElementById('vacancies-container');
            const resultsCount = document.getElementById('results-count');
    
            loadingSpinner.style.display = 'block';
            vacanciesContainer.innerHTML = '';
            resultsCount.textContent = '';
    
            try {
                const response = await fetch(`https://api.lmiforall.org.uk/api/v1/vacancies/search?keywords=${encodeURIComponent(query)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const jobs = await response.json();
    
                if (!jobs || jobs.length === 0) {
                    vacanciesContainer.innerHTML = `
                        <div class="alert text-center" role="alert">
                            No vacancies found. Please try a different search.
                        </div>
                    `;
                    return [];
                }
    
                return jobs;
            } catch (error) {
                console.error('Error fetching vacancies:', error);
                vacanciesContainer.innerHTML = `
                    <div class="alert text-center" role="alert">
                        Failed to load vacancies. Please try again later. 
                        ${error.message}
                    </div>
                `;
                return [];
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }
    
        // Display vacancies with enhanced formatting
        function displayVacancies() {
            const vacanciesContainer = document.getElementById('vacancies-container');
            const resultsCount = document.getElementById('results-count');
            const startIndex = (currentPage - 1) * jobsPerPage;
            const endIndex = startIndex + jobsPerPage;
            const vacaciesToShow = filteredVacancies.slice(startIndex, endIndex);
    
            resultsCount.textContent = `Showing ${vacaciesToShow.length} of ${filteredVacancies.length} vacancies`;
    
            let vacanciesHTML = `<div class="job-listings">`;
            
            vacaciesToShow.forEach(job => {
                // Safely extract job details with fallbacks
                const title = job.title || 'Job Title Not Available';
                const company = job.company || 'Company Not Specified';
                const location = (job.location && job.location.area) || 'Location Not Specified';
                const link = job.url || '#';
                const type = job.type || 'Full-time';
    
                vacanciesHTML += `
                    <div class="job-listing d-block d-sm-flex pb-3 pb-sm-0 align-items-center">
                        <div class="job-listing-about d-sm-flex custom-width w-100 justify-content-between mx-4">
                            <div class="job-listing-position custom-width w-50 mb-3 mb-sm-0">
                                <h2>
                                    <a href="${escapeHTML(link)}" target="_blank" class="job-title-link">
                                        ${escapeHTML(title)}
                                    </a>
                                </h2>
                                <strong>${escapeHTML(company)}</strong>
                            </div>
                            <div class="job-listing-location mb-3 mb-sm-0 custom-width w-25">
                                <span class="icon-room"></span> 
                                ${escapeHTML(location)}
                            </div>
                            <div class="job-listing-meta custom-width w-25 text-right">
                                <span class="badge badge-primary mr-2">${escapeHTML(type)}</span>
                                <a href="${escapeHTML(link)}" target="_blank" class="btn btn-primary btn-sm">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            vacanciesHTML += `</div>`;
            
            // Append or replace vacancies
            if (currentPage === 1) {
                vacanciesContainer.innerHTML = vacanciesHTML;
            } else {
                vacanciesContainer.innerHTML += vacanciesHTML;
            }
    
            // Manage Load More button visibility
            const loadMoreBtn = document.getElementById('load-more-btn');
            loadMoreBtn.style.display = filteredVacancies.length > endIndex ? 'block' : 'none';
        }
    
        // Comprehensive Filtering Function
        async function filterVacancies() {
            const keywordFilter = document.getElementById('keyword-filter').value.toLowerCase().trim();
            const locationFilter = document.getElementById('location-filter').value.toLowerCase();
    
            // If no keyword, fetch default top vacancies
            const query = keywordFilter || 'top';
            
            // Fetch vacancies based on keyword
            allVacancies = await fetchVacancies(query);
    
            // Reset pagination
            currentPage = 1;
    
            // Apply filters
            filteredVacancies = allVacancies.filter(job => {
                const matchKeyword = !keywordFilter || 
                    (job.title && job.title.toLowerCase().includes(keywordFilter)) ||
                    (job.company && job.company.toLowerCase().includes(keywordFilter));
                
                const matchLocation = !locationFilter || 
                    (job.location && job.location.area && 
                     job.location.area.toLowerCase().includes(locationFilter));
                
                return matchKeyword && matchLocation;
            });
    
            // Display filtered results
            displayVacancies();
        }
    
        // Load more vacancies
        function loadMoreVacancies() {
            currentPage++;
            displayVacancies();
        }
    
        // HTML Escaping to prevent XSS
        function escapeHTML(str) {
            if (!str) return '';
            return str
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    
        // Initialize page with top vacancies
        document.addEventListener('DOMContentLoaded', async () => {
            allVacancies = await fetchVacancies();
            filteredVacancies = [...allVacancies];
            displayVacancies();
        });
        </script>
    
    </body>
    </html>